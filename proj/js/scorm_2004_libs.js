"use strict";function handleError(e){alert(e)}function getProgress(){let e=scorm.get("cmi.location"),o=scorm.get("cmi.suspend_data");null!=e&&""!==e&&null!=o&&""!==o&&(window.scormLocation=""===e?null:e,window.scormBlocks=""===o?null:JSON.parse(o),window.hasScormProgress=!0),handleProgressUserInteraction(window.resumeSettings,window.hasScormProgress)}function uploadProgress(){if(window.lmsConnected){scorm.set("cmi.progress_measure",(window.progress/window.blocksCount).toString()),scorm.set("cmi.location",window.currentLesson.toString()),scorm.set("cmi.suspend_data",JSON.stringify(window.blocksCountLessons)),scorm.set("cmi.completion_status","incomplete");scorm.save()}}function disableWaitingData(){let e=document.querySelector(".scorm-loader-overlay"),o=document.querySelector(".body-js");e.style.display="none",o.classList.remove("body-no-scroll")}function initCourse(){if(window.lmsConnected=scorm.init(),lmsConnected){getProgress();const e=scorm.get("cmi.completion_status"),o=scorm.get("cmi.success_status");"completed"===e&&"passed"===o&&console.log("Вы уже прошли этот курс.")}else console.log("Ошибка: Курс не может связаться с LMS")}function setComplete(){if(lmsConnected){scorm.set("cmi.score.scaled",(finalScore/maxScore).toString()),scorm.set("cmi.score.min","0"),scorm.set("cmi.score.max",maxScore.toString()),scorm.set("cmi.score.raw",finalScore.toString()),scorm.set("cmi.score.scaled",(finalScore/maxScore).toString()),scorm.set("cmi.progress_measure",(window.progress/window.blocksCount).toString()),scorm.set("cmi.location",window.currentLesson.toString()),scorm.set("cmi.suspend_data",JSON.stringify(window.blocksCountLessons)),scorm.set("cmi.session_time",window.sessionTime());let e=scorm.set("cmi.completion_status","completed");finalScore>=maxScore*passPercentage/100?scorm.set("cmi.success_status","passed"):scorm.set("cmi.success_status","failed"),e?scorm.quit():console.log("Ошибка: Курс не может быть отмечен как пройденный!")}else console.log("Ошибка: Курс не подключён к LMS")}function initFinishButton(){let e=document.getElementById("complete-button"),o=document.getElementById("complete-button-failure");e&&(e.addEventListener("click",(function o(s){s.preventDefault(),setComplete(),e.removeEventListener("click",o),window.close();const t=document.getElementById("course"),n=document.querySelector("body");t.style.display="none",n.insertAdjacentHTML("beforeend",'<div class="container my-20 text-center"><p>Этот материал пройден. Закройте вкладку или переходите к другому материалу.</p></div>')})),o&&o.addEventListener("click",(function o(s){s.preventDefault(),setComplete(),e.removeEventListener("click",o),window.close();const t=document.getElementById("course"),n=document.querySelector("body");t.style.display="none",n.insertAdjacentHTML("beforeend",'<div class="container mb-20 text-center"><p>Этот материал пройден. Закройте вкладку или переходите к другому материалу.</p></div>')})))}window.scorm=pipwerks.SCORM,window.lmsConnected=null,window.hasScormProgress=!1,window.scormLocation=null,window.scormBlocks=null,window.onload=function(){disableWaitingData(),initCourse()},window.onbeforeunload=function(){lmsConnected&&scorm.quit()};
